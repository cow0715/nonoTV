<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>드라마</title>
    <link rel="stylesheet" href="./style/drama.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="menuBtn">
                <i class='bx bx-menu menu-icon navbarbtn'></i>
            </div>
            <div class="logo">
                <a href="index.html">
                    <span>OO티비</span>
                    <h1>OO티비 영화,드라마,예능, 미드, 애니 다시보기</h1>
                </a>
            </div>
        </div>
        <div class="search-container">
            <div class="search-box">
                <input type="search" class="search-input" placeholder="검색어를 입력하세요">
                <button type="submit" class="searchBtn"><i class='bx bx-search'></i></button>
            </div>
        </div>
        <div class="login-container">
            <div class="login">
                <a href="login.html">
                    <span>로그인</span>
                </a>
            </div>
        </div>
    </header>
    <div class="collapse-menu">
        <div class="collapse-box">
            <div class="home">
                <a href="#">
                    <i class='bx bx-home-alt' ></i>
                </a>
            </div>
            <div class="home">
                <a href="#">
                    <i class='bx bx-star' ></i>
                </a>
            </div>
            <div class="home">
                <a href="#">
                    <i class='bx bx-history' ></i>
                </a>
            </div>
        </div>
    </div>
    <aside id="aside" >
        <div class="nav-container">
            <div class="main-menu bottom-line">
                <div class="home">
                    <a href="#">
                        <i class='bx bx-home-alt' ></i>
                        <span>홈</span>
                    </a>
                </div>
                <div class="home">
                    <a href="#">
                        <i class='bx bx-star' ></i>
                        <span>인기영상</span>
                    </a>
                </div>
                <div class="home">
                    <a href="#">
                        <i class='bx bx-history' ></i>
                        <span>시청기록</span>
                    </a>
                </div>
            </div>
            <div class="sub-menu">
                <div class="nav-list bottom-line">
                    <div class="nav-movie">
                        <div class="nav-icon">
                            <i class='bx bx-movie'></i>
                            <span>영화</span>
                        </div>
                        <div class="nav-list-item">
                            <a href="#">한국영화</a>
                            <a href="#">해외영화</a>
                            <a href="#">[극장판]애니메이션</a>
                        </div>
                    </div>
                </div>
                <div class="nav-list bottom-line">
                    <div class="nav-movie">
                        <div class="nav-icon">
                            <i class='bx bx-tv' ></i>
                            <span>방송프로그램</span>
                        </div>
                        <div class="nav-list-item">
                            <a href="#">드라마</a>
                            <a href="#">예능프로그램</a>
                            <a href="#">다큐/시사</a>
                            <a href="#">애니메이션</a>
                            <a href="#">해외드라마</a>
                        </div>
                    </div>
                </div>
                <div class="nav-list bottom-line">
                    <div class="nav-movie">
                        <div class="nav-icon">
                            <i class='bx bx-film' ></i>
                            <span>추억의 저장소</span>
                        </div>
                        <div class="nav-list-item">
                            <a href="#">추억의 드라마</a>
                            <a href="#">추억의 예능</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </aside>
    <section>
        <div class="drama-container">
            <div class="drama-introduce">
                <h1>드라마</h1>
                <div class="pagerPerItem-container">
                    <select name="" id="pagePerItem">
                        <option value="5">5</option>
                        <option value="7">7</option>
                        <option value="10" selected>10</option>
                        <option value="15">15</option>
                    </select>
                    <span> 개 </span>
                </div>
                <select name="select-box" id="select-box">
                    <option value="default">필터선택</option>
                    <option value="view">조회수 높은순</option>
                    <option value="heart">좋아요 높은순</option>
                </select>
            </div>
            <div class="contents">
                <ul class="content-drama">
                    <!-- <li class="drama-box">
                        <a href="#">
                            <img src="./image/movie1.jpg" alt="">
                            <p class="drama-title">재벌집 막내아들</p>
                        </a>
                    </li>
                    <li class="drama-box">
                        <a href="#">
                            <img src="./image/movie2.jpg" alt="">
                            <p class="drama-title">금혼령, 조선혼인금지령</p>
                        </a>
                    </li>
                    <li class="drama-box">
                        <a href="#">
                            <img src="./image/movie3.jpg" alt="">
                            <p class="drama-title">빨간 풍선</p>
                        </a>
                    </li>
                    <li class="drama-box">
                        <a href="#">
                            <img src="./image/movie4.jpg" alt="">
                            <p class="drama-title">환혼 빛과 그림자</p>
                        </a>
                    </li>
                    <li class="drama-box">
                        <a href="#">
                            <img src="./image/movie5.jpg" alt="">
                            <p class="drama-title">삼남매가 용감하게</p>
                        </a>
                    </li> -->
                </ul>
            </div>
        </div>
        <div class="pagenation-container">
            <div id="prev"><i class='bx bxs-chevron-left'></i></div>
            <ul class="pagenation">
                <!-- <li>1</li>
                <li>2</li>
                <li>4</li>
                <li>5</li> -->
            </ul>
            <div id="next"><i class='bx bxs-chevron-right'></i></div>
        </div>
    </section>
    <footer>
        <div class="test">
            <div class="notice-container">
                <div class="notice-box">
                    <div class="notice"><a href="#">공지사항</a></div>
                    <div class="guide-link"><a href="#">공식 도메인 주소 변경 안내</a></div>
                </div>
                <div class="social-media">
                    <a href="#"><span><i class='bx bxl-telegram'></i></span></a>
                    <a href="#"><span><i class='bx bxl-instagram'></i></span></a>
                </div>
            </div>
        </div>
        <div class="test2">
            <div class="footer-content">
                <div class="footer-link">
                    <div class="link-box">
                        <ul>
                            <li><a href="#" class="liner">사이트 소개</a></li>
                            <li><a href="#" class="liner">이용약관</a></li>
                            <li><a href="#" class="liner">개인정보 취급방침</a></li>
                            <li><a href="#" class="liner">고객센터</a></li>
                            <li><a href="#" class="liner">자료요청</a></li>
                            <li><a href="#" class="liner">모바일 버전</a></li>
                            <li><a href="#">저작권 보호센터</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-introduce">
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit ipsa, molestiae tempora nesciunt voluptates quasi
                    </p>
                    <p>
                        voluptatum in ullam tenetur, nisi nulla, nihil qui accusamus ad corporis adipisci eligendi animi placeat.
                    </p>
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Suscipit ipsa, molestiae tempora nesciunt voluptates quasi
                    </p>
                    <p>
                        voluptatum in ullam tenetur, nisi nulla, nihil qui accusamus ad corporis adipisci eligendi animi placeat.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 사이드바 -->
    <script>
        
        const menuBtn = document.querySelector(".navbarbtn");
        const aside = document.querySelector("#aside");
        const collapse = document.querySelector(".collapse-menu");
        const section = document.querySelector("section");
        const footer = document.querySelector("footer");
        
        function menuClick(){
            aside.classList.toggle("hide");
            collapse.classList.toggle("show")
            section.classList.toggle("active3")
            footer.classList.toggle("active4")
        }
        menuBtn.addEventListener("click", menuClick);
    </script>

    <!-- pagination -->
    <script>
        let ary = [];
        let pagePerCount = pagePerItem.value;
        let pagers;
        let currentPage; 
        let startIndex;
        let endIndex; 

        let  pagenation = document.querySelector('.pagenation');
        let  lists;
        async function  loadDatas(){
            const response = await fetch('https://yts.mx/api/v2/list_movies.json');
            const datas = await response.json(); 
            console.log(datas.data.movies[0]);
            // ary = [...datas.data.movies];
            // ary = datas.data.movies;

            for( let a = 0 ; a<datas.data.movies.length ; a++){
                const newMovie = { myId:a, ...datas.data.movies[a] }
                ary.push(newMovie);
                console.log( newMovie );
            }
            console.log( ary.length );

            calculator();
            pagenationHandle(); 
            activeHandle(1); // 맨처음 오류
            repeatDom();   
        }
        loadDatas();

        function calculator(){
            pagers = Math.ceil(ary.length / pagePerCount); 
            startIndex = (currentPage - 1) * pagePerCount;
            endIndex =  currentPage * pagePerCount; 
        }
        
        function pagenationHandle(){
            pagenation.innerHTML = '';
            for(let a = 1;  a<= pagers ; a++){
                let li = document.createElement('li');
                li.classList.add('list');
                li.innerHTML = a; 
                //console.log( li );
                if( currentPage === a) li.classList.add('active');
                li.addEventListener('click', currentPageHandle );
                pagenation.appendChild(li);
            }
            lists = document.querySelectorAll('.list');
        }  

        function currentPageHandle(){
            console.log(this.innerHTML);
            //1
            activeHandle( this.innerHTML );
        }

        function activeHandle(num){
            // if( currentPage === 1  ) prev.style.display = "none";
            // if( currentPage > 1 ) prev.style.display = "block";
            // if( currentPage === 4 ) next.style.display = "none";
            // if( currentPage < 4 ) next.style.display = "block";
            // //보임 숨김을 이용해서 오류 발생 차단

            lists.forEach( list=> list.classList.remove('active'));

            console.log(lists);
            lists[num - 1].classList.add('active');

            currentPage = Number(num);
            startIndex = (currentPage - 1) * pagePerCount;
            endIndex =  currentPage * pagePerCount;
            repeatDom(); 
        }

        const tbody = document.querySelector('.content-drama');
        repeatDom(); 
        function repeatDom(){
            const viewTr = ary.slice(startIndex, endIndex);
           // console.log( viewTr );
            tbody.innerHTML = '';
            let str = '';
            for( tr of viewTr ){
                str += createDom( tr );
            }
            tbody.innerHTML = str; 
        }
        function createDom(data){
            let str = `
                <li class="drama-box">
                    <a href="#">
                        <img src="${data.large_cover_image}" alt="">
                        <p class="drama-title">${data.title}</p>
                    </a>
                </li>
            `
            return str; 
        }

        next.addEventListener('click', function(){
            if( currentPage === pagers) return; 
            currentPage++;
            activeHandle(currentPage);
        })

        prev.addEventListener('click', function(){
            if( currentPage > 0 ) {
                currentPage--;
                activeHandle(currentPage);
            }
        })

        pagePerItem.addEventListener('change', function(){
            pagePerCount = pagePerItem.value; 
            console.log( pagePerCount);

            calculator();
            pagenationHandle(); 
            activeHandle(1);  
            repeatDom();   
        })
    </script>
</body>
</html>